function select = poplistboxCB
%handles input of popup to change spot label generated by popuphere

cffig = openfig('labelgui','reuse');
handles = guidata(cffig); %handle structure of labelgui to check for checked menus


imgFigureH = GetUserData(openfig('labelgui','reuse'),'currentWindow');
if isempty(imgFigureH)
    return;
end;

%get info for current spot
hpop = gcbo;
textH = get(hpop,'UserData');
spId = get(textH,'UserData');
timeslideH = findall(cffig,'Tag','slider3');
idlist = GetUserData(imgFigureH,'idlist');
tp = get(timeslideH,'Value');

hpush = findall(0,'Style','pushbutton','Tag','deletespot');
if ~isempty(hpush)
    delete(hpush);
end;

rowIdx = find(idlist(tp).linklist(:,2)==spId);
spCol = idlist(tp).linklist(rowIdx(1),3); %color of the spot the label of which was changed

labelCNum = log2(spCol)+1;
if floor(labelCNum)~=labelCNum
    if ~isempty(hpop)
        delete(hpop);
    end;
    
    return %end eval here
end

sel = get(hpop,'Value'); %which menu point is selected
strList = get(hpop,'String');
set(textH,'String',strList(sel,:)); %write labelstring into textH-string

%change assignment of label to color
idlist(1).stats.labelcolor(labelCNum) = cellstr(strList(sel,:));


%redo projectData
%idlist = projectData(idlist);
SetUserData(imgFigureH,idlist,1);

if ~isempty(hpop)
    delete(hpop);
end;

%refresh labelgui to update all plots
labelgui('refresh');
