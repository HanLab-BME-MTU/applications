function label_editlabelCB
%handles input from window generated by label_editlabelistCB

cbobj = get(gcbo,'Style');
labelPanelH = GetUserData(openfig('labelgui','reuse'),'currentWindow');

switch cbobj
    
case 'edit'
    lboxH = findall(gcbf,'Style','listbox');
    labellist = get(lboxH,'String');
    cval = get(lboxH,'Value');
    lbl = get(gcbo,'String');
    if isempty(lbl)
        %remove lbl
        if (size(labellist,1))>2 & (cval~=size(labellist,1))
            clbllist = cellstr(labellist);
            clbllist = [clbllist(1:cval-1,:); clbllist(cval+1:end)];
            labellist = char(clbllist);
            cval = max(cval-1,1);
        end;
    else
        %change or add label
        clbllist = cellstr(labellist);
        clbllist(cval) = cellstr(lbl);
        if(cval==size(labellist,1))
            clbllist(end+1) = cellstr('new...');            
        end;
        labellist = char(clbllist);
    end;
    set(lboxH,'String',labellist);
    % remove 'new...'
    clbllist = cellstr(labellist);
    clbllist = clbllist(1:end-1);
    %save labellist as cell
    idlist = GetUserData(labelPanelH,'idlist');
    idlist(1).stats.labellist = clbllist;
    SetUserData(labelPanelH,idlist,1);
    
case 'listbox'
    strlist = get(gcbo,'String');
    val = get(gcbo,'Value');
    editH = findall(gcbf,'Style','edit');
    set(editH,'String',deblank(strlist(val,:)));
end;